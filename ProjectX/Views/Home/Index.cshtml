@using Entities.Models;
@model LoginResponse;

@{
    ViewData["Title"] = "Home";
}

<div class="container-fluid">

    <section>

        <div class="row">

            <div class="col col-sm-2 colunas">
                <nav class="navbar navbar-toggleable-sm box-shadow">
                    <ul class="navbar-nav flex-grow-1 justify-content-between">
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="Home" asp-action="Index">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">Home</span>
                            </a>
                        </li>
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="" asp-action="">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">My Profile</span>
                            </a>
                        </li>
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="" asp-action="">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">Friends</span>
                            </a>
                        </li>
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="" asp-action="">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">Galery</span>
                            </a>
                        </li>
                        <hr />
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="" asp-action="">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">Settings</span>
                            </a>
                        </li>
                        <li class="nav-item text-start d-flex align-items-center">
                            <a class="nav-link text-primary mx-3" asp-area="" asp-controller="" asp-action="">
                                <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                                <span class="mx-2">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="col-sm-7 colunas">

                <div class="row p-2">

                    <div class="row pb-3">

                        <div style="" class="flex-column col col-sm-1">
                            <img src="~/img/user.png" width="35" alt="Descrição da imagem">
                        </div>

                        <div class="col-sm-11">
                            <textarea id="text-area" class="feed-post" rows="4" cols="50" placeholder="What's on your mind?"></textarea>
                        </div>

                        <div class="col col-12 text-end">
                            @* <a asp-action="PostFeed" asp-controller="Home" asp-route-Id="@Model.Id">
                            <img src="~/img/send.png" width="20" alt="Descrição da imagem">
                            </a> *@
                            <a style="cursor: pointer;" onclick="PostPage()">
                                <img src="~/img/send.png" width="20" alt="Descrição da imagem">
                            </a>
                        </div>

                    </div>

                    <hr />

                    <div class="pb-3">
                        <h4 class="text-start">Recent posts</h4>
                    </div>

                    <div id="feed-row" class="row">

                        @* <div class="feed-item col col-sm-1">
                        <img src="~/img/user.png" width="20" alt="Descrição da imagem">
                        </div>
                        <div id="feed-container" class="col-sm-11">

                        </div> *@

                    </div>                 

                </div>

            </div>

            <div class="col-sm-3 friend-area">
                <div class="pb-3">
                    <h4 class="text-start">Friends</h4>
                </div>
                <div class="row justify-content-evenly">
                    <div class="window-friend col col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Rafael</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Thaise</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Maya</p>
                        </a>
                    </div>
                </div>
                <div class="row justify-content-evenly">
                    <div class="window-friend col col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Daniel</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Thiago</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Araújo</p>
                        </a>
                    </div>
                </div>
                <div class="row justify-content-evenly">
                    <div class="window-friend col col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Deivid</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>Jader</p>
                        </a>
                    </div>
                    <div class="window-friend col-sm-4">
                        <a href="https://google.com.br">
                            <img src="https://source.unsplash.com/random/30x30" width="30" alt="Descrição da imagem">
                            <p>João</p>
                        </a>
                    </div>
                    <a class="text-end text-secondary" href="https://youtube.com.br">All friends</a>
                </div>
            </div>
        </div>

    </section>

</div>

<script>

    $(document).ready(function () {
        LoadHomePage();
    });

    function LoadHomePage() {
        let request = {
            id: @Model.Id
                        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("GetFeed", "Home")',
            data: request
        }).done(function (response) {

            if (response.success) {

                let feed_row = document.querySelector("#feed-row");
                
                console.log(response.data[0]);

                for (let x = 0; x < response.data.length; x++) {

                    var imgUsers = document.createElement("img");
                    imgUsers.src = "https://source.unsplash.com/random/35x35";
                    imgUsers.width = 25;

                    var myDate = new Date(response.data[x].createdAt);
                    var options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                    var formattedDate = myDate.toLocaleDateString('pt-BR', options);

                    feed_row.innerHTML += `
                            <div>
                                <p style="font-size: 12px; text-align: end; padding: 0; margin: 0;"> ${formattedDate} </p>
                            </div>
                            <div class="feed-item col col-sm-2">
                                <img src="https://source.unsplash.com/random/30x30">
                                <p style="font-size: 12px"> ${response.data[x].userName} </p>
                            </div>
                            <div id="feed-container" class="col-sm-10 p-2">
                                ${response.data[x].feedText}
                            </div>
                                  `;

                    if(response.data[x].commentCount !== null){
                        feed_row.innerHTML += `
                            <div style="font-size: 12px; text-align: end; padding: 0; margin-top: -50px;">
                                         <a id="call_comments" style="text-decoration: none; cursor: pointer;" onclick="showComments(${response.data[x].postId})" >
                                         Show Comments 
                                     <span style="font-size: 12px; background-color: #096AD9; color: white; padding: 2px 4px 2px 4px; border-radius: 40%;"> ${response.data[x].commentCount} </span> 
                                     </a>                               
                            </div>

                            <div style="border: 1px solid red; margin-top: -30px; margin-left: auto; border-radius: 5px; display: none;" id="comments-row" class="row col-10 text-start">
                                
                            </div>
                        `
                        }
          

                    //showComments(response.data[x].postId)
               
                    // //img.alt = "Descrição da imagem";
                    // var div1 = document.createElement("div");
                    // div1.className = "feed-item col col-sm-2";
                    // div1.appendChild(imgUsers);

                    // var div2 = document.createElement("div");
                    // div2.id = "feed-container";
                    // div2.className = "col-sm-10";
                    // div2.innerHTML = response.data[x].postItem;

                    // var p = document.createElement("p");
                    // var myDate = new Date(response.data[x].postData);
                    // var options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                    // var formattedDate = myDate.toLocaleDateString('pt-BR', options);
                    // p.style.fontSize = '12px';
                    // p.innerHTML = formattedDate;

                    // div1.appendChild(p);

                    // feed_row.appendChild(div1);
                    // feed_row.appendChild(div2);
                    // feed_row.appendChild(document.createElement("hr"))
                }
             
                Swal.fire({
                    title: 'Oops!',
                    text: response.message,
                    icon: 'error',
                    confirmButtonColor: '#15549a'
                });

            }

        }).fail(function (response) {
            Swal.fire({
                title: 'Oops...',
                text: 'Não foi possível carregar os menus. Certifique-se que o usuário possua permissão e que a rota exista.',
                icon: 'error',
                confirmButtonColor: '#15549a'
            });
        });

        //return false;
    }

    function showComments(feedId) {

        let comments_row = document.querySelector("#comments-row");
        let link_called = document.querySelector("#call_comments").innerHTML = "Hide Comments";
        //let comment_user = document.querySelector("#comment-user");

        if (comments_row.classList.contains("show-item")) {
            comments_row.classList.remove("show-item");
            //comment_user.classList.remove("show-item");
            link_called = document.querySelector("#call_comments").innerHTML = `Show Comments`;
            comments_row.innerHTML = '';
        }

        else {

            let request = {
                feedId: feedId
            };

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetComments", "Home")',
                data: request
            }).done(function (response) {

                if (response.success) {
                    console.log("")
                    console.log("Comentários")
                    console.log(response.data);
                    console.log("")

                    comments_row.classList.add("show-item");
                    //comment_user.classList.add("show-item");

                    for (let x = 0; x < response.data.length; x++) {

                        comments_row.innerHTML += `
                           <div class="feed-item col col-sm-2 d-inline">
                               <img src="https://source.unsplash.com/random/30x30">
                               <p style="font-size: 12px"> ${response.data[x].userName} </p>
                           </div>
                           <div id="feed-container" class="col-sm-10 p-2">
                                   <span style="font-size: 13px"> ${response.data[x].feedComment} </span>
                           </div>
                         `;

                    }
                }

            }).fail(function (response) {
                Swal.fire({
                    title: 'Oops...',
                    text: 'Não foi possível carregar os menus. Certifique-se que o usuário possua permissão e que a rota exista.',
                    icon: 'error',
                    confirmButtonColor: '#15549a'
                });
            });
        }

        console.log("Comentario")
        console.log(comentario)

        return comentario;
    }

    function PostPage() {

        let postText = document.querySelector("#text-area").value

        let request = {
            id: @Model.Id,
            text: postText
        };

        console.log("")
        console.log("Aqui")
        console.log(request)
        console.log("")

        $.ajax({
            type: "POST",
            url: '@Url.Action("PostFeed", "Home")',
            data: request
        }).done(function (response) {

            if (response.success) {

                let feed_row = document.querySelector("#feed-row");

                console.log(response.data[0]);

                for (let x = 0; x < response.data.length; x++) {

                    var imgUsers = document.createElement("img");
                    imgUsers.src = "https://source.unsplash.com/random/35x35";
                    imgUsers.width = 25;

                    var myDate = new Date(response.data[x].createdAt);
                    var options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                    var formattedDate = myDate.toLocaleDateString('pt-BR', options);

                    feed_row.innerHTML += `
                                <div>
                                    <p style="font-size: 12px; text-align: end; padding: 0; margin: 0;"> ${formattedDate} </p>
                                </div>
                                <div class="feed-item col col-sm-2">
                                    <img src="https://source.unsplash.com/random/30x30">
                                    <p style="font-size: 12px"> ${response.data[x].userName} </p>
                                </div>
                                <div id="feed-container" class="col-sm-10 p-2">
                                    ${response.data[x].feedText}
                                </div>
                                    `;
                    // //img.alt = "Descrição da imagem";
                    // var div1 = document.createElement("div");
                    // div1.className = "feed-item col col-sm-2";
                    // div1.appendChild(imgUsers);

                    // var div2 = document.createElement("div");
                    // div2.id = "feed-container";
                    // div2.className = "col-sm-10";
                    // div2.innerHTML = response.data[x].postItem;

                    // var p = document.createElement("p");
                    // var myDate = new Date(response.data[x].postData);
                    // var options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                    // var formattedDate = myDate.toLocaleDateString('pt-BR', options);
                    // p.style.fontSize = '12px';
                    // p.innerHTML = formattedDate;

                    // div1.appendChild(p);

                    // feed_row.appendChild(div1);
                    // feed_row.appendChild(div2);
                    // feed_row.appendChild(document.createElement("hr"))
                }
                Swal.fire({
                    title: 'Oops!',
                    text: response.message,
                    icon: 'error',
                    confirmButtonColor: '#15549a'
                });

            }

        }).fail(function (response) {
            Swal.fire({
                title: 'Oops...',
                text: 'Não foi possível carregar os menus. Certifique-se que o usuário possua permissão e que a rota exista.',
                icon: 'error',
                confirmButtonColor: '#15549a'
            });
        });

        return false;
    }

</script>